description: >
  This file provides the settings to the datacleaner module.

  dry run: If enabled, all configured steps are executed but the result is
  not saved.

  data: In the system path setup, specify the root directory of the data directories.
  Each data directory must contain the output files generated by the wavetracker,
  as well as the raw grid file for computing the power spectra of newly added 
  tracks. A data directory must be named by the recording date and start time
  using the syntax YYYY-MM-DD-HH_MM. 

  output: Processed data will be stored with the same
  directory names into the output root directory. 

  exclude: Folders specified in 'exclude'
  (e.g. containing metadata) will not be processed. If the dataroot directory
  contains a subdirectory that does not contain grid data and is not specified
  in the 'exclude' list, an error will occur.

  fine_spec: Enable the fine_spec option, if it is desired to copy the fine spectrogram 
  to the output directory as well.

  fill_powers: Enable to recompute the powers at the tracked frequencies, if
  frequencies where manually tracked using the EODsorter GUI. This is almost 
  always desired. A complete power matrix for all tracked frequencies across the
  electrodes is needed for e.g. position estimation.

  remove_nans: Removes all unassigned frequency tracks.

  remove_short: Remove short frequency tracks using a threshold specified
  in seconds.

  remove_poor: Remove tracks with a low tracking performance, i.e. percentage
  of available datapoints for the whole time array for the tracks.

  compute_positions: Enable to triangulate position estimates based on a specified
  number of electrodes from the sign_v containing powers for each electrode for each 
  tracked frequency at each point in time.

  interpolate: Interpolate the frequencies, powers and positions for each fish. 
  This step is mandatory for position smoothing.

  smooth_positions: Uses a multiple filtering steps (velocity threshold,
  interpolation, median filter, savitzky golay filter) to remove outliers from
  the estimated coordinates. Use the notebook 
  ./demos/position_preprocessing_explorer.ipynb to find good parameters and 
  understand the processing steps.

  load_logger: Load a single hobologger file that must be located in the dataroot
  and resampled to 1 Hz. Also see the module ./utilities/hobologger_converter.py 
  for more information.

  norm_q10: Normalize frequency tracks by the Q10 value of the respective
  species to the specified temperature. This requires to load temperature
  information from the hobo logger. This is particularly useful to determine
  the sex of the individuals based on their EODf.

  bandpass: Bandpass filters the tracks. Use this feature with caution! Tracks
  may look nicer after filtering, but some information will be lost (depending 
  on the supplied filter parameters).

# Script setup
dry_run: True

# System path setup
data: "/home/weygoldt/Data/uni/efish/efishdata-local/" # where recordings are
output: "/home/weygoldt/Data/uni/efish/datacleaner-test/" # where processed recordigns go
exclude:
  - "hobo_logger_data"
  - "gone_with_the_grid"
  - "notes"
  - "2016-04-16-18_45"
  - "2016-04-18-19_22"
  - "Darktable"

include_only:
  - "2016-04-20-18_49"

# Processing steps
fine_spec: True # save fine spec to outputs

fill_powers: True # fill missing powers

remove_nans: True # remove all nans

remove_short: True # discard track below duration thresh
duration_threshold: 7200 # thresh in seconds

remove_poor: True # discard poorly tracked tracks
performance_threshold: 0.7 # performance thresh

compute_positions: True # triangulate fish positions
electrodes: 5 # use n electrodes for triangulation

interpolate: True # interpolate freqs, powers, coordinates

smooth_positions: True # tell datacleaner to smooth or not
position_processing:
  vthresh: 68 # in [cm/s]
  median_window: 9 # window for median filter
  smoothing_window: 100 # window for savgol filter
  smoothing_polyorder: 6 # polyorder for savgol filter

load_logger: True # resample, save temp and light data
logger_name: "hobologger.csv" # logger file must be in dataroot.

norm_q10: False # normalize by q10
tempnorm:
  q10: 1.6 # species q10 value
  normtemp: 25 # temp to normalize to

sex: False # determine sex of individuals
sex_params:
  upper: "m" # sex of higher freqs
  thresh: 740 # freq threshold for sexing

bandpass: False # bandpass filter
freq_bandpass:
  rate: 3 # sampling rate
  flow: 0.00004 # lower cutoff
  fhigh: 0.4 # higher cutoff
  order: 2 # filter order
  eod_shift: True # shift eod from 0 back to mode of track id
